import{ah as q,u as N,a as B,S as E,r as c,I as h,a1 as b,b as z,w as d,d as p,j as y,x as S,_ as I,f as u,B as T,V as o,e as t,U as V,ai as D,ap as J,D as Q,H as g}from"./index-CHLpyvbT.js";import{U as R,b as U}from"./back-MdFXvXK6.js";import{_ as A}from"./Admin-ES92iUVR.js";const F={key:0,class:"w-[75%] items-center flex"},M={class:"w-[49%]"},P=["src"],H={key:1,class:"w-[25%] mx-auto mb-5 flex justify-between mt-4"},K={class:"scan-confirmation flex justify-center items-center"},G=["src"],L={__name:"Enter",setup(W){const{t:r}=N(),v=B(),i=E(),w=c(""),l=h({id:"",full_name:" ",passport_pin:"",passport_number:"",img_url:"https://univer.hemis.uz/static/crop/2/1/320_320_90_2170006031.jpg",groupname:""}),k=c(""),n=c(!1),f=c(""),_=c(!1);h({name:v.userName,email:v.userEmail}),h({password_current:"",password:"",password_confirmation:""});const $=()=>{_.value=!1},C=()=>{_.value=!0},j=console.error,x=async a=>{try{f.value=JSON.stringify(a.map(m=>m.rawValue)),n.value=!0;const s=JSON.parse(f.value)[0];console.log("QR Code:",s)}catch(e){console.error("QR kodni o‘qishda xatolik:",e),n.value=!1}};b(n,a=>{console.log("Kamera holati:",a?"To‘xtatilgan":"Faol")}),b(f,async a=>{const e=JSON.parse(a)[0];console.log(e);try{console.log(localStorage.getItem("token")),w.value=e;let s=await fetch(`${window.url}/admin/student?student_id=${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({qr_code:e})});if(console.log("Status:",s.status),s.status==400){let m=await s.json();i.error(r("error qr")),n.value=!1;return}s.status==200?(s=await s.json(),console.log("Student info:",s),Object.assign(l,s.data[0]),console.log(l.full_name)):s.status===401&&console.log("Sizda kirish huquqi yo'q")}catch(s){console.error("Error:",s)}console.log(2e4)});const O=async a=>{console.log(a);try{let e=await fetch(`${window.url}/admin/enterstudent`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({student_id:a})});if(console.log("Status:",e.status),e.status==409){let s=await e.json();i.error(r("Siz bino ichidasiz"));return}if(e.status==404){let s=await e.json();i.error(r("Build failed")),n.value=!1;return}if(e.status==400){let s=await e.json();i.error(r("error qr")),n.value=!1;return}e.status==200?(e=await e.json(),console.log("Student info:",e),i.success(r("success enter")),n.value=!1):e.status===401&&console.log("Sizda kirish huquqi yo'q")}catch(e){console.error("Error:",e)}};return(a,e)=>{const s=V("n-table");return g(),z(A,null,{default:d(()=>[p(Q,null,{default:d(()=>[p(I,{icon:"mdi-account",title:u(r)("Binoga kirish"),main:""},{default:d(()=>[T(o(k.value),1)]),_:1},8,["title"]),n.value?(g(),y("div",F,[t("div",M,[t("img",{src:l.img_url,class:"rounded-[50%]",alt:""},null,8,P)]),t("div",null,[p(s,null,{default:d(()=>[t("thead",null,[t("tr",null,[t("th",null,o(a.$t("FullName")),1),t("th",null,o(l.full_name),1)]),t("tr",null,[t("th",null,o(a.$t("passport_pin")),1),t("th",null,o(l.passport_pin),1)]),t("tr",null,[t("th",null,o(a.$t("passport_number")),1),t("th",null,o(l.passport_number),1)]),t("tr",null,[t("th",null,o(a.$t("passport_number")),1),t("th",null,o(l.passport_number),1)]),t("tr",null,[t("th",null,o(a.$t("groupname")),1),t("th",null,o(l.groupname),1)])]),e[2]||(e[2]=t("tbody",null,null,-1))]),_:1})])])):S("",!0),n.value?(g(),y("div",H,[t("button",{onClick:e[0]||(e[0]=m=>n.value=!1),class:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"},o(u(r)("Cancel")),1),t("button",{onClick:e[1]||(e[1]=m=>O(w.value)),class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"},o(u(r)("Tasdiqlash")),1)])):S("",!0),p(u(R),{paused:n.value,onDetect:x,onCameraOn:$,onCameraOff:C,onError:u(j)},{default:d(()=>[D(t("div",K,[t("img",{src:u(U),alt:"QR topildi",class:"w-[300px] h-[300px]"},null,8,G)],512),[[J,_.value]])]),_:1},8,["paused","onError"])]),_:1})]),_:1})}}},ee=q(L,[["__scopeId","data-v-2556d93c"]]);export{ee as default};
